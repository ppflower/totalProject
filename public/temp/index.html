<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <title>Title</title>

    <link rel="stylesheet" href="stylesheets/reset.css">
    <link rel="stylesheet" href="stylesheets/index.css">
    <link rel="stylesheet" href="stylesheets/chatroom.css">
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">

    <script type="text/javascript" src="../script/util/jquery-3.2.1.js"></script>
    <script type="text/javascript" src="../script/util/ArrayList.js"></script>
    <script type="text/javascript" src="../script/util/three.js"></script>


    <script type="text/javascript" src="../script/util/WaterShader.js"></script>
    <script type="text/javascript" src="../script/util/OBJLoader.js"></script>
    <script type="text/javascript" src="../script/util/OrbitControls.js"></script>

    <script type="text/javascript" src="../script/util/CreateModel.js"></script>


    <script type="text/javascript"  src="../script/util/socket.io.js"></script>
    <script type="text/javascript"  src="../script/wenjin/chatroom.js"></script>

    <script type="text/javascript" src="../script/wenjin/MovableObject.js"></script>
    <script type="text/javascript" src="../script/wenjin/StaticObject.js"></script>
    <script type="text/javascript" src="../script/wenjin/Box.js"></script>
    <script type="text/javascript" src="../script/wenjin/Portal.js"></script>
    <script type="text/javascript" src="../script/wenjin/Boat.js"></script>
    <script type="text/javascript" src="../script/wenjin/Bullet.js"></script>
    <script type="text/javascript" src="../script/wenjin/Map.js"></script>
    <script type="text/javascript" src="../script/wenjin/Player.js"></script>
    <script type="text/javascript" src="../script/wenjin/GameManager.js"></script>
    <script type="text/javascript" src="../javascripts/index.js"></script>
    <!--<script type="text/javascript" src="../wenjin/Map.js"></script>-->
    <script type="text/javascript" src= "../script/Bird.js"></script>
    <script type="text/javascript" src= "../script/Projector.js"></script>
    <script type="text/javascript" src= "../script/CanvasRenderer.js"></script>
    <script type="text/javascript" src= "../script/stats.min.js"></script>
    <script type="text/javascript" src= "../script/Boid.js"> </script>

</head>
<style>
    #loading{
        margin-top: 100px;
        float: left;
    }
</style>
<body>

<div id="map-output">
    
</div>
<div id= "loading">
    <div id="container"></div>
    <p>Loading ...</p>
</div>
<script>
    var SCREEN_WIDTH = window.innerWidth,
    SCREEN_HEIGHT = window.innerHeight,
    SCREEN_WIDTH_HALF = SCREEN_WIDTH  / 2,
    SCREEN_HEIGHT_HALF = SCREEN_HEIGHT / 2;

    var camera, scene, renderer, birds, bird;

    var boid, boids;

    var stats;

    init();
    animate();
    setTimeout(function(){
        $("#loading").remove();
    },10000);

    function init() {

        camera = new THREE.PerspectiveCamera( 75, SCREEN_WIDTH / SCREEN_HEIGHT, 1, 10000 );
        camera.position.z = 450;

        scene = new THREE.Scene();

        birds = [];
        boids = [];

        for ( var i = 0; i < 200; i ++ ) {

            boid = boids[ i ] = new Boid();
            boid.position.x = Math.random() * 400 - 200;
            boid.position.y = Math.random() * 400 - 200;
            boid.position.z = Math.random() * 400 - 200;
            boid.velocity.x = Math.random() * 2 - 1;
            boid.velocity.y = Math.random() * 2 - 1;
            boid.velocity.z = Math.random() * 2 - 1;
            boid.setAvoidWalls( true );
            boid.setWorldSize( 500, 500, 400 );        

            bird = birds[ i ] = new THREE.Mesh( new Bird(), new THREE.MeshBasicMaterial( { color:Math.random() * 0xffffff, side: THREE.DoubleSide } ) );
            bird.phase = Math.floor( Math.random() * 62.83 );
            scene.add( bird );


        }

        renderer = new THREE.CanvasRenderer();
        renderer.setClearColor( 0xffffff );
        renderer.setPixelRatio( window.devicePixelRatio );
        renderer.setSize( SCREEN_WIDTH, SCREEN_HEIGHT );

        document.addEventListener( 'mousemove', onDocumentMouseMove, false );
        document.getElementById( 'loading' ).appendChild( renderer.domElement );

        stats = new Stats();
        document.getElementById( 'container' ).appendChild(stats.dom);

        //

        window.addEventListener( 'resize', onWindowResize, false );

    }

    function onWindowResize() {

        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();

        renderer.setSize( window.innerWidth, window.innerHeight );

    }

    function onDocumentMouseMove( event ) {

        var vector = new THREE.Vector3( event.clientX - SCREEN_WIDTH_HALF, - event.clientY + SCREEN_HEIGHT_HALF, 0 );

        for ( var i = 0, il = boids.length; i < il; i++ ) {

            boid = boids[ i ];

            vector.z = boid.position.z;

            boid.repulse( vector );

        }

    }

    //

    function animate() {

        requestAnimationFrame( animate );

        stats.begin();
        render();
        stats.end();

    }

    function render() {

        for ( var i = 0, il = birds.length; i < il; i++ ) {

            boid = boids[ i ];
            boid.run( boids );

            bird = birds[ i ];
            bird.position.copy( boids[ i ].position );

            color = bird.material.color;
            color.r = color.g = color.b = ( 500 - bird.position.z ) / 1000;

            bird.rotation.y = Math.atan2( - boid.velocity.z, boid.velocity.x );
            bird.rotation.z = Math.asin( boid.velocity.y / boid.velocity.length() );

            bird.phase = ( bird.phase + ( Math.max( 0, bird.rotation.z ) + 0.1 )  ) % 62.83;
            bird.geometry.vertices[ 5 ].y = bird.geometry.vertices[ 4 ].y = Math.sin( bird.phase ) * 5;

        }

        renderer.render( scene, camera );
    }
    
</script>

<div id="status-list">
    <ul class="list-group">
        <li class="list-group-item" id="status-list-title">
            <span class="glyphicon glyphicon-stats"></span>
            Status List:
        </li>

        <li class="list-group-item">
            <span class="glyphicon glyphicon-user"></span>
            Username:
            <span id="status-playerID"></span>
        </li>

        <li class="list-group-item">
            <span class="glyphicon glyphicon-heart-empty"></span>
            Health:
            <span id="status-health"></span>
        </li>

        <li class="list-group-item">
            <span class="glyphicon glyphicon-star"></span>
            Level:
            <span id="status-level"></span>
        </li>
    </ul>
</div>

<div id="ranking-list">
    <ul class="list-group">
        <li class="list-group-item" id="ranking-list-title">
            <span class="glyphicon glyphicon-sort-by-order-alt"></span>
            Ranking List:
        </li>

        <span id="ordered-user-list">
        </span>
    </ul>

</div>



<div id="chatroom-container">

    <ul class="pages">
        <li class="chat page">
            <div class="chatArea">
                <ul class="messages"></ul>
            </div>
            <input class="inputMessage" placeholder="Type here..."/>
        </li>
    </ul>
</div>


<div id="debug">
    
</div>

</body>
</html>